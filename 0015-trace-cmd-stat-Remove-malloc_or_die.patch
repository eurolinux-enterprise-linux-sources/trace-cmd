From 32818c104b935c2f5d30c4568032cc27862521d1 Mon Sep 17 00:00:00 2001
From: "Steven Rostedt (Red Hat)" <rostedt@goodmis.org>
Date: Mon, 21 Sep 2015 16:21:20 -0400
Subject: [PATCH 015/134] trace-cmd stat: Remove malloc_or_die()

Fail with a more descriptive message when failing to allocate.

Signed-off-by: Steven Rostedt <rostedt@goodmis.org>
---
 trace-stat.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/trace-stat.c b/trace-stat.c
index 0f1610ec526e..adbf3c3eb3be 100644
--- a/trace-stat.c
+++ b/trace-stat.c
@@ -74,9 +74,9 @@ char *append_file(const char *dir, const char *name)
 {
 	char *file;
 
-	file = malloc_or_die(strlen(dir) + strlen(name) + 2);
+	file = malloc(strlen(dir) + strlen(name) + 2);
 	if (!file)
-		die("malloc");
+		die("Failed to allocate %s/%s", dir, name);
 
 	sprintf(file, "%s/%s", dir, name);
 	return file;
@@ -158,7 +158,9 @@ struct event_iter *trace_event_iter_alloc(const char *path)
 {
 	struct event_iter *iter;
 
-	iter = malloc_or_die(sizeof(*iter));
+	iter = malloc(sizeof(*iter));
+	if (!iter)
+		die("Failed to allocate event_iter for path %s", path);
 	memset(iter, 0, sizeof(*iter));
 
 	iter->system_dir = opendir(path);
-- 
2.5.5

