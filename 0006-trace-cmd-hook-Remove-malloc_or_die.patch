From f06ec3608fe5237dcbf2399de727e001eb8465f7 Mon Sep 17 00:00:00 2001
From: "Steven Rostedt (Red Hat)" <rostedt@goodmis.org>
Date: Fri, 18 Sep 2015 17:29:23 -0400
Subject: [PATCH 006/134] trace-cmd hook: Remove malloc_or_die

Exit nicely if malloc fails.

Signed-off-by: Steven Rostedt <rostedt@goodmis.org>
---
 trace-hooks.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/trace-hooks.c b/trace-hooks.c
index 1d2bff21582b..4238f83cb984 100644
--- a/trace-hooks.c
+++ b/trace-hooks.c
@@ -37,12 +37,16 @@ struct hook_list *tracecmd_create_event_hook(const char *arg)
 	int ch;
 	int i;
 
-	hook = malloc_or_die(sizeof(*hook));
+	hook = malloc(sizeof(*hook));
+	if (!hook)
+		return NULL;
 	memset(hook, 0, sizeof(*hook));
 
 	str = strdup(arg);
-	if (!str)
-		die("malloc");
+	if (!str) {
+		free(hook);
+		return NULL;
+	}
 
 	hook->str = str;
 	hook->hook = arg;
@@ -157,7 +161,7 @@ struct hook_list *tracecmd_create_event_hook(const char *arg)
 	return hook;
 
 invalid_tok:
-	die("Invalid hook format '%s'", arg);
+	warning("Invalid hook format '%s'", arg);
 	return NULL;
 }
 
-- 
2.5.5

