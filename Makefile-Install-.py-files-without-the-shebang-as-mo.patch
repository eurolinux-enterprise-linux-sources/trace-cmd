From c15f27c793c0eddbe7d76a0a0ca4dcb6dd54e067 Mon Sep 17 00:00:00 2001
From: John Kacur <jkacur@redhat.com>
Date: Fri, 23 Aug 2013 02:51:38 +0200
Subject: [PATCH 6/7] Makefile: Install *.py files without the shebang as mode
 644 Signed-off-by: John Kacur <jkacur@redhat.com>

---
 Makefile | 16 ++++++++++++++--
 1 file changed, 14 insertions(+), 2 deletions(-)

diff --git a/Makefile b/Makefile
index d53cde3df4a8..160c2c6ceb2f 100644
--- a/Makefile
+++ b/Makefile
@@ -86,7 +86,8 @@ ifeq ($(shell sh -c "python-config --includes > /dev/null 2>&1 && echo y"), y)
 	PYTHON_PLUGINS := plugin_python.so
 	BUILD_PYTHON := $(PYTHON) $(PYTHON_PLUGINS)
 	PYTHON_SO_INSTALL := ctracecmd.install
-	PYTHON_PY_INSTALL := event-viewer.install tracecmd.install tracecmdgui.install
+	PYTHON_PY_INSTALL := event-viewer.install
+	PYTHON_PY_NOEXEC_INSTALL := tracecmd.install tracecmdgui.install
 endif
 endif # NO_PYTHON
 
@@ -503,6 +504,14 @@ define do_install
 	$(INSTALL) $1 '$(DESTDIR_SQ)$2'
 endef
 
+define do_install_noexec
+	$(print_install)				\
+	if [ ! -d '$(DESTDIR_SQ)$2' ]; then		\
+		$(INSTALL) -d -m 644 '$(DESTDIR_SQ)$2';	\
+	fi;						\
+	$(INSTALL) -m 644 $1 '$(DESTDIR_SQ)$2'
+endef
+
 $(PLUGINS_INSTALL): %.install : %.so force
 	$(Q)$(call do_install,$<,$(plugin_dir_SQ))
 
@@ -514,10 +523,13 @@ $(PYTHON_SO_INSTALL): %.install : %.so force
 $(PYTHON_PY_INSTALL): %.install : %.py force
 	$(Q)$(call do_install,$<,$(python_dir_SQ))
 
+$(PYTHON_PY_NOEXEC_INSTALL): %.install : %.py force
+	$(Q)$(call do_install_noexec,$<,$(python_dir_SQ))
+
 $(PYTHON_PY_PLUGINS): %.install : %.py force
 	$(Q)$(call do_install,$<,$(plugin_dir_SQ))
 
-install_python: $(PYTHON_SO_INSTALL) $(PYTHON_PY_INSTALL) $(PYTHON_PY_PLUGINS)
+install_python: $(PYTHON_SO_INSTALL) $(PYTHON_PY_INSTALL) $(PYTHON_PY_NOEXEC_INSTALL) $(PYTHON_PY_PLUGINS)
 
 install_cmd: all_cmd install_plugins install_python
 	$(Q)$(call do_install,trace-cmd,$(bindir_SQ))
-- 
1.8.3.1

